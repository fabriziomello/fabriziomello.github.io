
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fabrízio de Royes Mello</title>
  <meta name="author" content="Fabrízio de Royes Mello">

  
  <meta name="description" content="Não é oficial ainda mas parece que não teremos mais uma versão 8.5 do PostgreSQL&#8230; a nova versão será 9.0 conforme discussão na lista de &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://fabriziomello.github.io/blog/page/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Fabrízio de Royes Mello" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-49388509-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Fabrízio de Royes Mello</a></h1>
  
    <h2>Blog sobre Tecnologia da Informação</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:fabriziomello.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/01/22/postgresql-85-vs-90/">PostgreSQL 8.5 vs 9.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-22T00:00:00-02:00" pubdate data-updated="true">Jan 22<span>nd</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Não é oficial ainda mas parece que não teremos mais uma versão 8.5 do PostgreSQL&#8230; a nova versão será 9.0 conforme discussão na lista de desenvolvimento do mesmo [1].<br /><br />O motivo dessa mudança é o grande número de novas funcionalidades que irá incorporar a nova versão do PostgreSQL&#8230; isso é muito interessante pois a evolução do &#8220;elefantinho&#8221; está cada vez mais acelerada&#8230;<br /><br />Vida longa ao PostgreSQL!!!<br /><br /><br />[1] <a href="http://archives.postgresql.org/pgsql-hackers/2010-01/msg02056.php">http://archives.postgresql.org/pgsql-hackers/2010-01/msg02056.php</a><br /><br /><br />Cordialmente,<br /><br />Fabrízio de Royes Mello<br />fabriziomello [at] gmail.com</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/07/03/case-pgbouncer-13-com-postgresql-82/">Case PgBouncer 1.3 Com PostgreSQL 8.2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-03T00:00:00-03:00" pubdate data-updated="true">Jul 3<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Pessoal,<br /><br />Estou finalizando a implantação do <a href="https://developer.skype.com/SkypeGarage/DbProjects/PgBouncer">PgBouncer</a><a href="https://developer.skype.com/SkypeGarage/DbProjects/PgBouncer"> 1.3</a> com <a href="http://www.postgresql.org/docs/8.2/interactive/index.html">PostgreSQL 8.2</a> e obtive excelentes resultados só pelo fato de colocar o Pool de Conexões na frente do &#8220;postmaster&#8221;.<br /><br />Até aqui não temos nada de muito surpreendente a não ser pelo fato de que, segundo a documentação do próprio <a href="https://developer.skype.com/SkypeGarage/DbProjects/PgBouncer">PgBouncer</a> fala que podemos ter 100% de transparência com o <a href="http://www.postgresql.org/docs/8.3/interactive/index.html">PostgreSQL 8.3</a> pelo fato do comando &#8221;<a href="http://www.postgresql.org/docs/8.3/interactive/sql-discard.html">DISCARD</a>&#8221; estar presente apartir dessa release.<br /><br />Como na versão que estamos utilizando, a 8.2, não existe essa implementação então o jeito foi implementar uma PL que &#8220;emule&#8221; o comportamento do &#8221;<a href="http://www.postgresql.org/docs/8.3/interactive/sql-discard.html">DISCARD</a>&#8221;.<br /><br />Através da lista de discussão da Comunidade Brasileira de PostgreSQL (<a href="https://listas.postgresql.org.br/cgi-bin/mailman/listinfo/pgbr-geral">pgbr-geral)</a>, com a ajuda do colega <a href="http://www.timbira.com/">Euler</a>, implementei uma PL para suprir essa falta conforme segue:<br /><pre><br /><span style=";font-family:courier new;font-size:78%;"  >create or replace function fc_discard_all() returns void as<br />$$<br />declare<br />  rComando record;<br />  iVersao  integer;<br />begin<br /><br />  select cast(setting as integer) <br />    into iVersao<br />    from pg_settings <br />   where name ~ 'server_version_num';<br /><br />  if not found then<br />    raise exception 'A versão do PostgreSQL deve ser >= 8.2';<br />  end if;<br /><br />  if iVersao >= 80300 then<br />    execute 'discard all';<br />    return;<br />  end if;<br /><br />  set session authorization default;<br /><br />  reset all;<br /><br />  for rComando in <br />    select name <br />      from pg_prepared_statements<br />  loop<br />    execute 'deallocate '||rComando.name;<br />  end loop;<br /><br />  for rComando in<br />    select name<br />      from pg_cursors<br />     where name not like '%unnamed%' <br />  loop<br />    execute 'close '||rComando.name;<br />  end loop;<br /><br />  unlisten *;<br /><br />  perform pg_advisory_unlock_all();<br /><br />  for rComando in<br />    select distinct<br />           table_schema,<br />           table_name<br />      from information_schema.tables <br />     where table_type = 'LOCAL TEMPORARY'<br />  loop<br />    execute 'drop table if exists '||quote_ident(rComando.table_schema)||'.'||quote_ident(rComando.table_name)||' cascade';<br />  end loop;<br /><br />  return;<br />end;<br />$$<br />language plpgsql;<br /></span><br /></pre>No meu arquivo de configuração do pool (pgbouncer.ini) fiz o seguinte:<br /><br />server_reset_query = SELECT fc_discard_all()<br /><br /><br />Os únicos efeitos colaterais dessa solução são:<br /><ol><li>Se a base de dados que for acessada não tiver a PL acima criada vai gerar um log de erro, mas não impacta em problemas na conexão</li><li>Não foi possível implementar uma emulação para o DISCARD PLANS pois, segundo o colega <a href="http://www.timbira.com">Euler</a>, esse comando <a href="http://listas.postgresql.org.br/pipermail/pgbr-geral/2009-June/015926.html">veio em conjunto com a funcionalidade de invalidação de planos em funções procedurais, logo não pode ser emulada em versões menores que 8.3</a><br /></li></ol>Tive de implementar esse recurso pois preciso descartar tabelas temporárias e outros recursos que são utilizados pela minha aplicação.<br /><br />O modo do pool que estou utilizando é o &#8220;session&#8221; pois preciso da sessão do inicio ao fim com o mesmo estado.<br /><br />Se alguém tiver alguma dica e/ou critica estou a disposição.<br /><br /><br />Cordialmente,<br /><br />Fabrízio de Royes Mello<br />fabriziomello [at] gmail.com</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/07/01/postgresql-84-lancado/">PostgreSQL 8.4 Lançado</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-01T00:00:00-03:00" pubdate data-updated="true">Jul 1<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Há poucas horas foi aunciado na lista pgsql-announce, pelo Sr. Josh Berkus, o lançamento versão 8.4 do PostgreSQL.<br /><br />Mais informações e a nota oficial de lançamento traduzidas podem ser encontradas em:<br /><br /><a href="http://www.postgresql.org/about/press/presskit84.html.br">http://www.postgresql.org/about/press/presskit84.html.br</a><br /><br /><br />Cordialmente,<br /><br />Fabrízio de Royes Mello<br />fabriziomello [at] gmail.com</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/07/01/palestra-database-refactoring-com/">Palestra Database Refactoring Com PostgreSQL - URCAMP Alegrete/RS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-01T00:00:00-03:00" pubdate data-updated="true">Jul 1<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Ontem (30/06/2009) ministrei a palestra de Database Refactoring para os alunos do Curso de Informática da Universidade da Região da Campanha (URCAMP) de Alegrete/RS.<br /><br />O evento contou com a presença de alunos dos últimos semestres do Curso de Informática bem como de alguns docentes do Curso.<br /><br />Os slides da palestra estão disponíveis em:<br /><br /><a href="http://www.slideshare.net/fabriziomello/database-refactoring-postgresql-urcamp-alegrete-2009">http://www.slideshare.net/fabriziomello/database-refactoring-postgresql-urcamp-alegrete-2009</a><br /><br />As fotos também estão disponíveis em:<br /><br /><a href="http://picasaweb.google.com/fabriziomello/UrcampAlegreteRS2009">http://picasaweb.google.com/fabriziomello/UrcampAlegreteRS2009</a><br /><br />Agradeço o convite feito pelos professores Cristian Talles e Eveline Guerra bem como a todos que participaram do evento, para mim foi uma honra trocar conhecimento com todos vocês.<br /><br /><br />Cordialmente,<br /><br />Fabrízio de Royes Mello<br />fabriziomello [at] gmail.com</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/07/01/disponibilizado-pgadmin-v1100/">Disponibilizado pgAdmin v1.10.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-01T00:00:00-03:00" pubdate data-updated="true">Jul 1<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Pessoal,<br /><br />Após mais de um ano de desenvolvimento foi disponibilizada a tão esperada versão 1.10.0 do <a href="http://www.pgadmin.org">pgAdmin</a>.<br /><br />Algumas das novas funcionalidades dessa versão:<br /><ul><li>Construtor Gráfico de Consultas (Graphical Query Builder)</li><li>Motor de Scripts na ferramenta de consulta (<a href="http://pgscript.projects.postgresql.org/">pgScript</a>)</li><li>Suporte melhorado para <a href="http://www.enterprisedb.com/products/postgres_plus_as/overview.do">Postgres Plus Advanced Server</a> e <a href="http://www.greenplum.com/products/greenplum-database/">Greeplum Database</a></li><li>Suporte a &#8220;Full Text Search&#8221;</li><li>Mecanismo para integração com ferramentas de terceiros</li><li>Suporte para PostgreSQL 8.4<br /></li></ul>Vejam a nota oficial do lançamento:<br /><br /><a href="http://www.postgresql.org/about/news.1107">http://www.postgresql.org/about/news.1107</a><br /><br /><br />Cordialmente,<br /><br />Fabrízio de Royes Mello<br />fabriziomello [at] gmail.com</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/07/01/compilando-o-pgadmin-1100-no-ubuntu-904/">Compilando O pgAdmin 1.10.0 No Ubuntu 9.04</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-01T00:00:00-03:00" pubdate data-updated="true">Jul 1<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Ontem (30/06/2009) como já anunciado no blog foi liberada a nova versão do <a href="http://www.pgadmin.org">pgAdmin</a>, entretanto ainda não foram disponibilizadas versões compiladas do mesmo para Linux.<br /><br />Então para instalar não teve jeito, tive de fazer download dos fontes e compilar e para isso tive de seguir os seguinte passos:<br /><br />1) Instalar os pré-requisitos<br /><br />sudo apt-get install build-essential<br />sudo apt-get install libxml2-dev<br />sudo apt-get install libgtk2.0-dev<br />sudo apt-get install libxslt1-dev<br />sudo apt-get install postgresql-server-dev-8.3<br />sudo apt-get install libwxbase2.8-dev<br />sudo apt-get install libwxgtk2.8-dev<br /><br />2) Download do pgAdmin<br /><br /><a href="http://www.pgadmin.org/download/">http://www.pgadmin.org/download/</a><br /><br /><br />3) Descompactar os fontes<br /><br />tar xzvf pgadmin3-1.10.0.tar.gz<br /><br /><br />4) Compilar e instalar<br /><br />cd pgadmin3-1.10.0<br />./configure &#8211;with-pgsql=/usr/lib/postgresql/8.3 &#8211;prefix=/usr/local/pgadmin3<br />make<br />make install<br /><br /><br />5) Agora basta executá-lo<br /><br />/usr/local/pgadmin3<br /><br /><br />Uma peculiaridade é que no meu caso tenho o <a href="http://www.postgresql.org/">PostgreSQL 8.3</a> instalado no meu Desktop então utilizei o pacote de desenvolvimento desta versão, mas creio que não exista problema algum em utilizar versões anteriores como a 8.2 ou 8.1.<br /><br />Outro detalhe é que apesar de eu estar utilizando o <a href="http://www.ubuntu.com">Ubuntu 9.04</a> esse processo deve ser o igual para versões anteriores e até mesmo para o próprio <a href="http://www.debian.org">Debian</a>.<br /><br />Fazendo isso temos o nosso pgAdmin 1.10.0 pronto para ser utilizado, bem simples e rápido.<br /><br /><br />Cordialmente,<br /><br />Fabrízo de Royes Mello<br />fabriziomello [at] gmail.com</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Fabrízio de Royes Mello</div>
<div class='content'>
Caro Beto,<br /><br />Esse artigo é somente sobre compilação/instalação do pgadmin 1.10, portanto não irá interferir na sua instalação existente do PostgreSQL.<br /><br /><br />Cordialmente,<br /><br />Fabrízo de Royes Mello<br />fabriziomello [at] gmail.com</div>
</div>
<div class='comment'>
<div class='author'>betolima</div>
<div class='content'>
Fabrizio, já tenho o postgre 8.3 instalado no meu ubuntu e quero somente instalar o pgadmin3. Estas dicas suas são para instalar somente o pgadmin?<br />Tenho medo de instalar o banco novamente, não posso fazer isso senão perco todos os meus dados, por isso quero instalar somente o pgadmin3. Posso seguir o seu tuto? valeu</div>
</div>
<div class='comment'>
<div class='author'>Fabrízio de Royes Mello</div>
<div class='content'>
Interessante, pois aqui no meu Ubuntu 9.04 esse link já existe:<br /><br />[dbseller@dbseller-note07:/dados]$ ls -al /usr/lib/libcrypto.*<br />-rw-r&#8211;r&#8211; 1 root root 2262370 2009-06-11 12:34 /usr/lib/libcrypto.a<br />lrwxrwxrwx 1 root root      23 2009-07-01 00:15 /usr/lib/libcrypto.so -&gt; /lib/libcrypto.so.0.9.8<br />lrwxrwxrwx 1 root root      23 2009-06-26 08:33 /usr/lib/libcrypto.so.0.9.8 -&gt; /lib/libcrypto.so.0.9.8<br /><br /><br />Cordialmente,<br /><br />Fabrízo de Royes Mello<br />fabriziomello [at] gmail.com</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Tive que criar um link simbolico para o libcrypto.<br />sudo ln -s /usr/lib/libcrypto.so.0.9.8 /usr/lib /libcrypto.so</div>
</div>
<div class='comment'>
<div class='author'>Fabrízio de Royes Mello</div>
<div class='content'>
Você instalou o meta-pacote &quot;build-essential&quot; conforme o item 1 ??<br /><br />Porque até onde sei o compilador C++ é instalado quando instalamos esse meta-pacote &quot;build-essential&quot;.<br /><br />Uma pequena verificação que você pode fazer para saber se o compilador está instalado:<br /><br />dpkg &#8211;list &#39;g++*&#39;<br /><br />Se o problema persistir tente instalar individualmente os seguintes pacotes:<br /><br />apt-get install libc6-dev<br />apt-get install libc-dev<br />apt-get install g++<br />apt-get install make<br />apt-get install dpkg-dev<br /><br />Cordialmente,<br /><br />Fabrízo de Royes Mello<br />fabriziomello [at] gmail.com</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
olá<br />no passo 4) Compilar e instalar retornou o seguinte erro:<br />configure: error: could not find a suitable C++ compiler to build pgAdmin</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/06/09/pgcon-brasil-2009-chamada-de-trabalhos/">PGCon Brasil 2009 - Chamada De Trabalhos</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-06-09T00:00:00-03:00" pubdate data-updated="true">Jun 9<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Está aberta a <a href="http://pgcon.postgresql.org.br/2009/chamadas.php">Chamada de Trabalhos</a> para o <a href="http://pgcon.postgresql.org.br/2009/index.php">PGCon Brasil 2009</a><a href="http://pgcon.postgresql.org.br/2009/index.php"> - 3a Conferência Brasileira de PostgreSQL</a>.<br /><br />Se você utiliza o <a href="http://www.postgresql.org/">PostgreSQL</a> ou tem essa intenção, não deixe de participar. Seja como palestrante ou visitante você será muito bem vindo ao maior evento brasileiro sobre o &#8220;Banco de Dados Open-Source mais poderoso do mundo<a href="http://www.postgresql.org/"></a>&#8221;.<br /><br />Informações e dicas de publicação também podem ser encontradas em:<br /><br /><a href="http://www.midstorm.org/%7Etelles/2009/05/31/aberta-a-chamada-de-trabalhos-para-o-pgcon-brasil-2009/">http://www.midstorm.org/~telles/2009/05/31/aberta-a-chamada-de-trabalhos-para-o-pgcon-brasil-2009/</a><br /><br />Vida longa ao PostgreSQL!!!<br /><br /><br />Cordialmente,<br /><br />Fabrízio de Royes Mello<br />fabriziomello [at] gmail.com</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/04/27/refatoracao-de-banco-de-dados-porto/">Refatoração De Banco De Dados - Porto Alegre AgileWeekend 2009</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-27T00:00:00-03:00" pubdate data-updated="true">Apr 27<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Esse final de semana (25 e 26 de abril de 2009) tive a oportunidade de participar, como palestrante, do <a href="http://agileweekend.guma-rs.org/">Porto Alegre AgileWeekend 2009 [1]</a>, discursando  sobre Refatoração de Banco de Dados (Database Refactoring) <a href="http://www.slideshare.net/fabriziomello/refatorao-banco-de-dados-agileweekend2009">[2]</a> utilizando o PostgreSQL.<br /><br />O evento contou com conteúdo de alto nível, demonstrando cases de sucesso na  aplicação de métodos e práticas ágeis no desenvolvimento de software  tais como:<br /><br />- Lean Software Development<br />- eXtreme Programming<br />- Scrum<br />- FDD (Feature-Driven Development), TDD (Test-Driven Developmento, BDD  (Behavior-Driven Development)<br />- etc&#8230;<br /><br />Além do alto nível dos conteúdos apresentados também não posso deixar de mencionar a alta qualidade da organização do evento que beirou a &#8220;perfeição&#8221; (e sem exageros&#8230; mas isso não seria resultado da aplicação prática de algum Métodos Ágil por parte de seus organizadores???).<br /><br />O que pude perceber ao longo de todas exposições, é que alguns dos objetivos desses &#8220;Métodos Ágeis&#8221; são a Satisfação do  Cliente e Qualidade do Produto entregue (aquilo que buscamos  constantemente).<br /><br />Atualmente existem diversas empresas (inclusive de nível global)  investindo em Métodos Ágeis, tais como:<br />- Borland<br />- Adobe<br />- Toyota (Criadora do Lean Software Development, que pode-se dizer que é  &#8220;pai&#8221; de todos métodos ágeis)<br />- Globo.com<br />- etc&#8230;<br /><br />Segundo um representante da <a href="http://www.rs.sucesu.org.br/">SUCESU-RS [4]</a>:  &#8220;Aqui no nosso estado os CIOs  das 40 maiores empresas estão olhando com &#8220;muito carinho&#8221; para os  métodos ágeis&#8221;. Será que isso não pode-se caracterizar uma tendência de mercado????<br /><br /><br />Outro ponto positivo é que o evento foi bem diversificado, demonstrando além  de questões técnicas a respeito de desenvolvimento de software, muita  informação Gerencial, no que diz respeito aos objetivos empresariais&#8230;  as práticas para maximizar resultados e eliminar desperdícios, dentre  outros.<br /><br /><br />Em uma palestra sobre SCRUM foi comentada a utilização de práticas ágeis aplicadas ao  setor de Suporte de uma empresa de desenvolvimento de software&#8230; em  outra o pessoal está utilizando essa &#8220;cultura&#8221; nos processos  administrativos da empresa&#8230; então a &#8220;Cultura Ágil&#8221; vai além do  desenvolvimento de software?!?!?!  Não surpreendam-se de em algum tempo ouvirmos coisas do tipo &#8220;Refatorar Processos de Negócio!&#8221;&#8230; &#8220;Refatorando as Finanças de sua Empresa&#8221;&#8230; (adoro refatoração&#8230; hehehehe)<br /><br /><br />Abaixo seguem alguns links com informações sobre o evento, a minha  palestra e algumas fotos:<br /><br />[1] Site do Evento<br /><a class="moz-txt-link-freetext" href="http://agileweekend.guma-rs.org/">http://agileweekend.guma-rs.org/</a><br /><br />[2] Slides da minha Palestra<br /><a class="moz-txt-link-freetext" href="http://www.slideshare.net/fabriziomello/refatorao-banco-de-dados-agileweekend2009">http://www.slideshare.net/fabriziomello/refatorao-banco-de-dados-agileweekend2009</a><br /><br />[3] Fotos do Evento<br /><a class="moz-txt-link-freetext" href="http://picasaweb.google.com/fabriziomello/Agileweekend2009">http://picasaweb.google.com/fabriziomello/Agileweekend2009</a><br /><br />[4] Site SUCESU-RS<br /><a class="moz-txt-link-freetext" href="http://www.rs.sucesu.org.br/">http://www.rs.sucesu.org.br/</a><br /><br />Cordialmente,<br /><br />Fabrízio de Royes Mello<br />fabriziomello [at] gmail.com</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Luiz Cláudio Parzianello</div>
<div class='content'>
Grande Fabrizio! Obrigado por ter acreditado em nosso sonho e ter participado do evento! Gostaria de acrescentar uma informação ao teu post: o representante da Sucesu-RS era o Eduardo Arruda, Presidente da entidade também CIO do Tribunal de Justiça do Estado do Rio Grande do Sul. Outra coisa &#8230; coisa da idéia da refatoração! Vamos refatorar diariamente nossas vidas!!! Hehehe!!!! Abraços!</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/01/10/postgresql-recuperao-de-erro-failed-to/">PostgreSQL - Recuperação De Erro “failed to Re-find Parent Key” No Start Do Processo</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-01-10T00:00:00-02:00" pubdate data-updated="true">Jan 10<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<div class="entry">      <div class="snap_preview"><p>Esses dias um cliente ligou com problemas no start do PostgreSQL e, verificando nos logs, encontrei o seguinte:</p> <p>2009-01-07 14:24:15 BRST 3939    LOG:  database system was interrupted while in recovery at 2009-01-07 14:19:55 BRST<br />2009-01-07 14:24:15 BRST 3939    HINT:  This probably means that some data is corrupted and you will have to use the last backup for recovery.<br />2009-01-07 14:24:15 BRST 3939    LOG:  checkpoint record is at AF/90DF2348<br />2009-01-07 14:24:15 BRST 3939    LOG:  redo record is at AF/90DF2348; undo record is at 0/0; shutdown FALSE<br />2009-01-07 14:24:15 BRST 3939    LOG:  next transaction ID: 300561523; next OID: 3349191252<br />2009-01-07 14:24:15 BRST 3939    LOG:  next MultiXactId: 347; next MultiXactOffset: 693<br />2009-01-07 14:24:15 BRST 3939    LOG:  database system was not properly shut down; automatic recovery in progress<br />2009-01-07 14:24:15 BRST 3937    WARNING:  autovacuum not started because of misconfiguration<br />2009-01-07 14:24:15 BRST 3937    HINT:  Enable options “stats_start_collector” and “stats_row_level”.<br />2009-01-07 14:24:15 BRST 3939    LOG:  redo starts at AF/90DF238C<br />2009-01-07 14:24:15 BRST 3940 [unknown] [unknown] [local] LOG:  incomplete startup packet<br />2009-01-07 14:24:16 BRST 3943 postgres postgres [local] FATAL:  the database system is starting up<br />2009-01-07 14:24:16 BRST 3946 postgres postgres [local] FATAL:  the database system is starting up<br />2009-01-07 14:24:16 BRST 3939    LOG:  record with zero length at AF/9115D62C<br />2009-01-07 14:24:16 BRST 3939    LOG:  redo done at AF/9115D5D4<br />2009-01-07 14:24:16 BRST 3939    PANIC:  failed to re-find parent key in “2658″ for split pages 173209/173210<br />2009-01-07 14:24:16 BRST 3937    LOG:  startup process (PID 3939) was terminated by signal 6<br />2009-01-07 14:24:16 BRST 3937    LOG:  aborting startup due to startup process failure<br />2009-01-07 14:24:16 BRST 3938    LOG:  logger shutting down<br />2009-01-07 14:24:16 BRST 3938    LOG:  logger shutting down</p> <p>Não conseguia iniciar o postgresql nem em single-mode… o que fazer então?!?!</p> <p>Com uma breve pesquisa no Google consegui detectar que era um problema em índices e para solucionar teria de rodar um <em>reindex</em>, etc…. também descobri que já aconteceu esse problema quando rodava o <em>vacuum</em> em bases, e que o mesmo já foi corrigido… até ai tudo bem, mas no meu caso não foi executado um <em>vacuum</em>, o que ocorreu foi alguma falha no servidor (por problemas de queda de energia) e o postgresql não conseguia iniciar de forma alguma.</p> <p>Fiz algumas tentativas mas todas sem sucesso… mas não tentei usar o <em>pg_resetxlog</em> por não ter certeza dos dados que seriam perdidos com esse procedimento, quis tentar recuperar o máximo de informação possível. Até poderia ter obtido sucesso, mas antes fui investigar o problema dando uma examinada nos fontes do “elefantinho”.</p> <p>Com um <em>find</em> descobri:</p> <p>dbseller@dbseller-note07:~/fabrizio/downloads/postgres/src/postgresql-8.1.15$ find . -name “*.c” -exec grep -il “failed to re-find parent key in” {} \;<br />./src/backend/access/nbtree/nbtpage.c<br />./src/backend/access/nbtree/nbtinsert.c</p> <p>Que sorte né (ou azar…rsrsrs)… apenas 2 fontes geram esse log… então resolvi tomar uma medida radial, alterar os fontes e recompilar, então seguem os passos:</p> <p>1 - Backup Físico do Cluster (antes de qualquer tentativa… para garantir qualquer imprevisto né… heheeh);</p> <p>2 - Alterei o fonte src/access/nbtree/nbtinsert.c :</p> <p>de</p> <pre style="font-family: courier new;"><span style="font-size:100%;">  /* Check for error only after writing children */<br /> if (pbuf == InvalidBuffer)<br />    elog(ERROR, "failed to re-find parent key in \"%s\" for split pages %u/%u",<br />       RelationGetRelationName(rel), bknum, rbknum);<br /><br /> /* Recursively update the parent */<br /> _bt_insertonpg(rel, pbuf, stack->bts_parent,<br />          0, NULL, new_item, stack->bts_offset,<br />          is_only);</span></pre> <p>para</p> <pre style="font-family: courier new;"><span style="font-size:100%;">  /* Check for error only after writing children */<br /> if (pbuf == InvalidBuffer)<br />   elog(<strong>WARNING</strong>, "failed to re-find parent key in \"%s\" for split pages %u/%u",<br />      RelationGetRelationName(rel), bknum, rbknum);<br /><strong>  else</strong><br />   /* Recursively update the parent */<br />   _bt_insertonpg(rel, pbuf, stack->bts_parent,<br />            0, NULL, new_item, stack->bts_offset,<br />            is_only);</span></pre> <p>Obs: Também poderia ter alterado o fonte <em>nbtpage.c</em> mas verifiquei que no <em>start</em> do postgresql ele não passa por aquele ponto. Os itens em negrito foram as alterações que efetuei.</p> <p>3 - Compilar/Instalar fontes com esse Hack;</p> <p>4 - Iniciar o PostgreSQL com o Hack, e desta vez o startup foi concluido com sucesso… heheheh…. quer dizer… com “um pouco mais de sucesso”;</p> <p>5 - Reindexar o Catálogo do PostgreSQL (<em>REINDEX SYSTEM postgres</em>);</p> <p>6 - Parar o PostgreSQL com o Hack e iniciar com os binários originais… aqui foi a supresa… funcionou perfeitamente… não ocorreu mais o erro pois o problema foi em índices do catálogo… e nem poderiam ser em outros índices né, uma vez que o banco não verifica índices de bases no <em>startup</em>, com excessão do catálogo;</p> <p>7 - REINDEX nas outras bases de dados;</p> <p>8 - Novo Backup das bases de dados (lógico e físico) sem problemas.</p> <p>Bom pessoal, podem fazer suas críticas… dizerem que minha solução foi meio que “irresponsável”, e concordo plenamente com essa posição e não recomendo a ninguém sair alterando fontes do postgresql que nem fiz pois os resultados podem ser imprevisiveis… mas o importante  é que no meu caso funcionou e gostaria de compartilhar com a comunidade essa pequena “aventura”.</p> <p>Vida longa ao “elefantinho”!!!!</p> </div>    </div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Parabéns !</div>
</div>
<div class='comment'>
<div class='author'>Fabrízio de Royes Mello</div>
<div class='content'>
Meu amigo &#8220;Anônimo&#8221;,<BR/><BR/>Eis uma feliz (ou infeliz) coincidência&#8230; mas realmente não estou plagiando a lista oficial do PostgreSQL e muito menos o Sr. Tom Lane, o qual respeito, e muito, seu trabalho&#8230;<BR/><BR/>Sofri um dia inteiro &#8220;fuçando&#8221; nos fontes do PostgreSQL (alterando, compilando, re-compilando, etc), até porque gosto de programação e a estrutura e organização do mesmo é fantástica, uma aula de desenvolvimento&#8230; <BR/><BR/>Confesso que fiz pouco uso do Sr. Google e inverti um pouco a ordem das coisas&#8230; se eu tivesse partido por esse caminho não teria sofrido tanto é verdade e não ficaria agora com essa sensação de ter plagiado alguém&#8230;<BR/><BR/>Mas infelizmente aconteceu essa coincidência&#8230; a questão é que tive um problema, encontrei uma solução (que diga-se de passagem nada convencional) e publiquei exatamente o que fiz&#8230; se eu tivesse encontrado a solução mencionada com certeza a teria citado&#8230; sem problema algum&#8230; <BR/><BR/>Não tenho porque fazer uma coisa desse tipo&#8230; quantas pessoas passam pelos mesmos problemas e as solucionam da mesma maneira sem saber como as outras procederam??? pense nisso!!!<BR/><BR/>Peço desculpas pela demora da publicação desse comentário e desculpem a todos se &#8220;re-inventei a roda&#8221; com esse post.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Seria interessante você citar de onde você tirou a sua solução, não?<BR/><BR/>http://archives.postgresql.org/pgsql-admin/2007-03/msg00018.php</div>
</div>
<div class='comment'>
<div class='author'>Dickson Guedes</div>
<div class='content'>
Além da análise que você já está fazendo, acredito que o monitoramento de logs em busca de erros &#8220;obscuros&#8221; poderia complementar o seu relatório final do procedimento que você executou.<BR/><BR/>No demais parabéns pelo novo blog.</div>
</div>
<div class='comment'>
<div class='author'>Fabrízio de Royes Mello</div>
<div class='content'>
Amigo Dickson,<BR/><BR/>Obrigado pelo questionamento!<BR/><BR/>Era uma base pequena, com ~18G&#8230;<BR/><BR/>Acredito ter ficado tudo íntegro sim&#8230; tenho acompanhado essa instância de perto e não encontrei nada de anormal&#8230; <BR/><BR/>Verifiquei, a nível da nossa aplicação, se houve perda de informação (principais procedimentos do software) e até agora não encontrei problemas.<BR/><BR/>Inclusive o gerente do CPD do meu cliente está monitorando com seus usuários se houveram problemas e até agora não obtive nenhum retorno negativo.<BR/><BR/>Sugeres algum procedimento para verificação???<BR/><BR/>[]s</div>
</div>
<div class='comment'>
<div class='author'>Dickson Guedes</div>
<div class='content'>
Ola Fabrizio,<BR/><BR/>Que tamanho mais ou menos tinha essa base?<BR/><BR/>Olhando o LOG &#8220;PANIC: failed to re-find parent key in “2658″ for split pages 173209/173210&#8221;&#8230;<BR/><BR/>e agora um SELECTizinho:<BR/><BR/># SELECT relname from pg_class where oid=2658;<BR/>             relname             <BR/>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;<BR/> pg_attribute_relid_attnam_index<BR/><BR/><BR/>Era problema em índice mesmo&#8230; o seu procedimento foi interessante mas fica a dúvida: Está tudo íntegro?<BR/><BR/>Acompanhe como essa instância se comportará e nos comunique. &#8220;:)<BR/><BR/>[]s</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/01/10/postgresql-procurar-determinado-oid-no/">PostgreSQL - Procurar Determinado OID No Catálogo</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-01-10T00:00:00-02:00" pubdate data-updated="true">Jan 10<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Hoje na lista <a href="https://listas.postgresql.org.br/cgi-bin/mailman/listinfo/pgbr-geral">postgresql-br</a> um membro relatou um problema ao executar um <a href="http://www.postgresql.org/docs/current/interactive/app-pgdump.html"><span style="font-style: italic;">pg_dump</span></a> o qual acusava não encontrar um <a href="http://www.postgresql.org/docs/current/static/ddl-schemas.html"><span style="font-style: italic;">schema</span></a> com um determinado <a href="http://www.postgresql.org/docs/current/static/datatype-oid.html">OID</a>.<br /><br /><a href="http://listas.postgresql.org.br/pipermail/pgbr-geral/2009-January/013616.html">Erro relatado</a>:<br /><br /><pre><br /><span style="font-size:85%;"><span style="font-family:courier new;"># pg_dump -U postgres -d jetclass -v -Fc -f banco.backup -n public</span><br /><span style="font-family:courier new;">pg_dump: reading schemas</span><br /><span style="font-family:courier new;">pg_dump: reading user-defined functions</span><br /><span style="font-family:courier new;">pg_dump: reading user-defined types</span><br /><span style="font-family:courier new;">pg_dump: schema with OID 264202372 does not exist</span><br /><span style="font-family:courier new;">pg_dump: *** aborted because of error</span><br /></span><br /></pre><br /><br />A solução para esse problema é procurar nas tabelas do catálogo (<a href="http://www.postgresql.org/docs/current/static/ddl-schemas.html">schema</a> <a href="http://www.postgresql.org/docs/current/static/catalogs.html">pg_catalog</a>) para encontrar o <a href="http://www.postgresql.org/docs/current/static/datatype-oid.html">OID</a> que está gerando o erro e <a href="http://www.postgresql.org/docs/current/static/sql-delete.html">deletá-lo</a> da base.<br /><br />Baseado nessa solução criei uma pequena função em <a href="http://www.postgresql.org/docs/current/static/plpgsql.html">plpgsql</a> para varrer o catálogo e procurar pelo OID problemático:<br /><br /><pre><br /><span style="font-size:85%;"><span style="font-family:courier new;">create or replace function fc_procura_oid(oid) returns boolean as</span><br /><span style="font-family:courier new;">$$</span><br /><span style="font-family:courier new;">declare</span><br /><span style="font-family:courier new;">  xOid     alias for $1;</span><br /><span style="font-family:courier new;">  lRetorno boolean default false;</span><br /><span style="font-family:courier new;">  lAchou   boolean default false;</span><br /><span style="font-family:courier new;">  rTabelas record;</span><br /><span style="font-family:courier new;">  sExecuta text;</span><br /><span style="font-family:courier new;">begin</span><br /><span style="font-family:courier new;">  for rTabelas in</span><br /><span style="font-family:courier new;">      select pg_class.relname,</span><br /><span style="font-family:courier new;">             'SELECT EXISTS(SELECT oid FROM '||quote_ident(nspname)||'.'||quote_ident(relname)||' WHERE oid = ' as sql_to_search</span><br /><span style="font-family:courier new;">        from pg_attribute</span><br /><span style="font-family:courier new;">             inner join pg_class on pg_class.oid = pg_attribute.attrelid</span><br /><span style="font-family:courier new;">             inner join pg_namespace on pg_namespace.oid = pg_class.relnamespace</span><br /><span style="font-family:courier new;">       where pg_attribute.attname = 'oid'</span><br /><span style="font-family:courier new;">         and pg_class.relkind     = 'r'</span><br /><span style="font-family:courier new;">         and pg_namespace.nspname = 'pg_catalog'</span><br /><span style="font-family:courier new;">    order by 1</span><br /><span style="font-family:courier new;">  loop</span><br /><span style="font-family:courier new;">    sExecuta := rTabelas.sql_to_search || xOid || ')';</span><br /><span style="font-family:courier new;">    execute sExecuta into lAchou;</span><br /><br /><span style="font-family:courier new;">    if lAchou then</span><br /><span style="font-family:courier new;">      raise info 'OID % encontrado na tabela %', xOid, rTabelas.relname;</span><br /><span style="font-family:courier new;">      lRetorno := true;</span><br /><span style="font-family:courier new;">    end if;</span><br /><span style="font-family:courier new;">  end loop;</span><br /><br /><span style="font-family:courier new;">  return lRetorno;</span><br /><span style="font-family:courier new;">end;</span><br /><span style="font-family:courier new;">$$</span><br /><span style="font-family:courier new;">language plpgsql;</span></span><br /></pre><br /><br />Para executar essa basta acessar a base via <a href="http://www.postgresql.org/docs/current/static/app-psql.html">psql</a> (ou até mesmo com <a href="http://www.pgadmin.org/">pgadmin</a>) e rodar:<br /><br /><pre><br /><span style="font-size:85%;"><span style="font-family:courier new;">training=# select fc_procura_oid(16);</span><br /><span style="font-family:courier new;">INFO:  OID 16 encontrado na tabela pg_type</span><br /><span style="font-family:courier new;"> fc_procura_oid </span><br /><span style="font-family:courier new;">----------------</span><br /><span style="font-family:courier new;"> t</span><br /><span style="font-family:courier new;">(1 registro)</span><br /></span><br /></pre><br /><br />Essa função retorna TRUE caso encontre, emitindo um echo na tela com o nome da(s) tabela(s) onde ele achou, ou FALSE caso negativo.<br /><br /><span style="font-style: italic;"></span></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
valew a dica&#8230;.</div>
</div>
<div class='comment'>
<div class='author'>quinho666</div>
<div class='content'>
Saudações de Sapiranga! Estaremos de olho, e certamente aproveitaremos as dicas!<BR/>\m/</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Show de bola meu amigo!!! Ótima idéia este blog.</div>
</div>
</div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/05/01/postgresql-aguardando-pela-9-dot-4-introduzindo-jsonb/">PostgreSQL (Aguardando Pela 9.4) - Introduzindo JSONB, Um Formato Estruturado Para Armazenar Objetos JSON</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/26/projeto-aceito-no-google-summer-of-code-2014-gsoc2014/">Projeto Aceito No Google Summer of Code 2014 (GSoC2014)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/10/novidades/">Novidades</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/10/database-refactoring/">Database Refactoring</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/10/bad-smells-mal-cheiros-em-bancos-de/">Bad Smells (Mal Cheiros) Em Bancos De Dados</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/fabriziomello">@fabriziomello</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'fabriziomello',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/fabriziomello@gmail.com?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Fabrízio de Royes Mello -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'fabriziomello';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
